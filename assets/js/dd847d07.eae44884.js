"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7281],{59845:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>a});var n=s(74848),t=s(28453);const o={title:"File Access Rules",taxonomy:{category:"docs"},slug:"/policy/filerules"},l=void 0,r={id:"policy/filerules/filerules",title:"File Access Rules",description:"Policy: File Access Rules",source:"@site/versioned_docs/version-5.3/05.policy/07.filerules/07.filerules.md",sourceDirName:"05.policy/07.filerules",slug:"/policy/filerules",permalink:"/5.3/policy/filerules",draft:!1,unlisted:!1,editUrl:"https://github.com/neuvector/docs/edit/main/versioned_docs/version-5.3/05.policy/07.filerules/07.filerules.md",tags:[],version:"5.3",sidebarPosition:7,frontMatter:{title:"File Access Rules",taxonomy:{category:"docs"},slug:"/policy/filerules"},sidebar:"tutorialSidebar",previous:{title:"Process Profile Rules",permalink:"/5.3/policy/processrules"},next:{title:"Response Rules",permalink:"/5.3/policy/responserules"}},c={},a=[{value:"Policy: File Access Rules",id:"policy-file-access-rules",level:3},{value:"Zero-drift File Protection",id:"zero-drift-file-protection",level:4},{value:"Basic File Protections",id:"basic-file-protections",level:4},{value:"Behavioral-learning based Allowed Applications in Discover Mode",id:"behavioral-learning-based-allowed-applications-in-discover-mode",level:4},{value:"Creating Custom File/Directory Monitoring Rules",id:"creating-custom-filedirectory-monitoring-rules",level:4},{value:"File access rule order precedence",id:"file-access-rule-order-precedence",level:4},{value:"Examples",id:"examples",level:4},{value:"Other Responses",id:"other-responses",level:4},{value:"Split Mode File Protections",id:"split-mode-file-protections",level:3}];function d(e){const i={a:"a",admonition:"admonition",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h3,{id:"policy-file-access-rules",children:"Policy: File Access Rules"}),"\n",(0,n.jsx)(i.p,{children:"There are two types of Process/File protections in NeuVector. One is Zero-drift, where allowed process and file activity are automatically determined based on the container image, and second is a behavioral learning based. Each can be customized (rules added manually) if desired."}),"\n",(0,n.jsx)(i.p,{children:"NeuVector has built-in detection of suspicious file system activity. Sensitive files in containers normally do not change at run-time. By modifying the content of the sensitive files, an attacker can gain unauthorized privileges, such as in the Dirty-Cow linux kernel attack, or damage the system\u2019s integrity, for example by manipulating the /etc/hosts file. Most containers don't run in read-only mode. Any suspicious activity in containers, hosts, or the NeuVector Enforcer container itself will be detected and logged into Notifications -> Security Events."}),"\n",(0,n.jsx)(i.h4,{id:"zero-drift-file-protection",children:"Zero-drift File Protection"}),"\n",(0,n.jsx)(i.p,{children:"This is the default mode for process and file protections. Zero-drift automatically allows only processes which originate from the parent process that is in the original container image, and does not allow file updates or new files to be installed. When in Discover or Monitor mode, zero-drift will alert on any suspicious process or file activity. In Protect mode, it will block such activity. Zero-drift does not require file activity to be added to an allow-list. Disabling zero-drift for a group will cause the process and file rules listed for the group to take effect instead."}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.p,{children:"The process/file rules listed for each group are always applied, even when zero-drift is enabled. This offers a way to add allow/deny exceptions to the base zero-drift protections. Keep in mind that if a group starts in Discover mode, process/file rules can be automatically added to the list, and should be reviewed and edited before moving to Monitor/Protect modes."})}),"\n",(0,n.jsx)(i.p,{children:"The ability to enable/disable zero-drift mode is in the console in Policy -> Groups. Multiple groups can be selected to toggle this setting for all selected groups."}),"\n",(0,n.jsx)(i.h4,{id:"basic-file-protections",children:"Basic File Protections"}),"\n",(0,n.jsx)(i.p,{children:"If a package installation is detected, an automatic re-scan of the container or host will be triggered to detect any vulnerabilities, IF auto-scan has been enabled in Security Risks -> Vulnerabilities."}),"\n",(0,n.jsx)(i.p,{children:"In addition to monitoring predefined files/directories, users can add custom files/directories to be monitored, and block such files/directories from being modified."}),"\n",(0,n.jsx)(i.admonition,{title:"important",type:"warning",children:(0,n.jsx)(i.p,{children:"NeuVector alerts, and does not block modifications to predefined files/directories or in system containers such as Kubernetes ones. Blocking is only an option for user configured custom files/directories for non-system containers. This is so that regular updates of system folder or sensitive configurations are not blocked unintentionally, resulting in erratic system behavior."})}),"\n",(0,n.jsx)(i.p,{children:"The following files and directories are monitored by default:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Executable files"}),"\n",(0,n.jsx)(i.li,{children:"Sensitive setuid/setgid files"}),"\n",(0,n.jsx)(i.li,{children:"System libraries, libc, pthread, ..."}),"\n",(0,n.jsx)(i.li,{children:"Package installation, Debian/Ubuntu, RedHat/CentOS, Alpine"}),"\n",(0,n.jsx)(i.li,{children:"Sensitive system files, /etc/passwd, /etc/hosts, /etc/resolv.conf \u2026"}),"\n",(0,n.jsx)(i.li,{children:"Running processes' executable files"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"The following activities are monitored:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Files, directories, symlinks (hard link and soft link)"}),"\n",(0,n.jsx)(i.li,{children:"created, deleted, modified (content change) and moved"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Below is a list of the file system monitoring and what is monitored (container, host/node, and/or NeuVector enforcer container itself):"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"/bin, /usr/bin, /usr/sbin, /usr/local/bin - container, enforcer"}),"\n",(0,n.jsx)(i.li,{children:"Files of setuid and setgid attribute - container, host, enforcer"}),"\n",(0,n.jsx)(i.li,{children:"Libraries: libc, pthread, ld-linux.* - container, host, enforcer"}),"\n",(0,n.jsx)(i.li,{children:"Package installation: dpkg, rpm, apk - container, host, enforcer"}),"\n",(0,n.jsx)(i.li,{children:"/etc/hosts, /etc/passwd, /etc/resolv.conf - container, host, enforcer"}),"\n",(0,n.jsx)(i.li,{children:"Binaries of the running processes - container"}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"behavioral-learning-based-allowed-applications-in-discover-mode",children:"Behavioral-learning based Allowed Applications in Discover Mode"}),"\n",(0,n.jsx)(i.p,{children:"When in Discover mode, NeuVector can learn and whitelist applications ONLY for specified directories or files. To enable learning, a custom rule must be created and the Action must be set to Block, as described below."}),"\n",(0,n.jsx)(i.h4,{id:"creating-custom-filedirectory-monitoring-rules",children:"Creating Custom File/Directory Monitoring Rules"}),"\n",(0,n.jsx)(i.p,{children:"Custom file access rules can be created for both custom user-defined Groups as well as auto-learned Groups."}),"\n",(0,n.jsx)(i.p,{children:"Users can add new entries for file/directory rules."}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Filter: Configure the file/folder to be protected (wildcards are supported)"}),"\n",(0,n.jsx)(i.li,{children:"Set the recursive flag (if all files in the subdirectories are to be protected)"}),"\n",(0,n.jsx)(i.li,{children:"Select the action, Monitor or Block (see Actions below)"}),"\n",(0,n.jsx)(i.li,{children:"Enter allowed applications (see Note1 below)"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(37359).A+"",width:"2056",height:"466"})}),"\n",(0,n.jsx)(i.p,{children:"Actions:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Monitor file changes. Generate alerts (Notifications) for any changes"}),"\n",(0,n.jsxs)(i.li,{children:["Block unauthorized access.","\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Service in Discover mode: the file access behavior is learned (the processes/applications that access the protected file) and added to the Allowed Applications."}),"\n",(0,n.jsx)(i.li,{children:"Service in Monitor mode: unexpected file behavior is alerted."}),"\n",(0,n.jsx)(i.li,{children:"Service in Protect mode: unexpected access (read, modify) is blocked. New file creation in protected folders will be blocked as well."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.p,{children:"If the rule is set to Block, and the service is in Discover mode, NeuVector will learn the applications accessing the file and add these to the Allowed Applications for the rule."})}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.p,{children:"Container platforms running the AUFS storage driver will not support the deny (block) action in Protect mode for creating/modifying files due to the limitations of the driver. The behavior will be the same a Monitor mode, alerting upon suspicious activity."})}),"\n",(0,n.jsx)(i.h4,{id:"file-access-rule-order-precedence",children:"File access rule order precedence"}),"\n",(0,n.jsx)(i.p,{children:"A container can inherit file access rule from multiple custom groups and user created file access rule on auto learned group."}),"\n",(0,n.jsx)(i.p,{children:"File access rules are prioritized in the order below if the file name conflicts with predefined access rules of auto learned group and rules inheritance of multiple groups."}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"File access rule with block access (highest order)"}),"\n",(0,n.jsx)(i.li,{children:"File access rule with recursive enabled"}),"\n",(0,n.jsx)(i.li,{children:"File access rule with recursive disable"}),"\n",(0,n.jsx)(i.li,{children:"User created file access rule other than predefined file access rules"}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"examples",children:"Examples"}),"\n",(0,n.jsx)(i.p,{children:"Showing file access rule to protect /etc/hostname file of node-pod service and allow vi application to modify the file."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(84310).A+"",width:"1054",height:"327"})}),"\n",(0,n.jsx)(i.p,{children:"Showing file access rule to protect files under /var/opt/ directory recursively for modification as well reading. The Allowed Application python can have read and modify access to these files."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(65933).A+"",width:"1043",height:"356"})}),"\n",(0,n.jsx)(i.p,{children:"Showing access rule that protects file /etc/passwd, which is one of the files covered predefined access rule in order to modify the file access action, for modification as well reading. This custom rule changes the default action of the predefined file access rule. The application Nano can have 'read and modify' access to these files. Must also add the Nano application (process) as an 'allow' rule in the process profile rule for this service to run Nano application inside the service (if it wasn't already whitelisted there), otherwise the process will be blocked by NeuVector."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(25988).A+"",width:"1035",height:"350"})}),"\n",(0,n.jsx)(i.p,{children:"Showing that the application python was learned accessing file under /var/opt directory when service mode of node-pod was in Discover. This occurs only when the rule is set to Block and the service is in Discover mode."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(7643).A+"",width:"997",height:"214"})}),"\n",(0,n.jsx)(i.p,{children:"Showing predefined file access rules for the service node-pod.demo-nvqa. This can be viewed for this service by clicking the info icon \u201cshow predefined filters\u201d in the right corner of the file access rule tab."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(69871).A+"",width:"1002",height:"412"})}),"\n",(0,n.jsx)(i.p,{children:"Showing a sample security event in Notifications -> Security Events, alerted as File access denial when modification of the file /etc/hostname by the application python was denied due to a custom file access rule with block action."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileRules",src:s(37207).A+"",width:"1037",height:"239"})}),"\n",(0,n.jsx)(i.h4,{id:"other-responses",children:"Other Responses"}),"\n",(0,n.jsx)(i.p,{children:"If other special mitigations, responses, or alerts are desired for File System Violations, a Response Rule can be created. See the example below and the section Run-Time Security Policy -> Response Rules for more details."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"FileResponse",src:s(45450).A+"",width:"1016",height:"533"})}),"\n",(0,n.jsx)(i.h3,{id:"split-mode-file-protections",children:"Split Mode File Protections"}),"\n",(0,n.jsxs)(i.p,{children:["Container Groups can have Process/File rules in a different mode than Network rules, as described ",(0,n.jsx)(i.a,{href:"/policy/modes#network-service-policy-mode",children:"here"}),"."]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},84310:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/example1-9013eb0bc2eefdef040c101db016962f.png"},65933:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/example2-c995de8e52c5639e70cf9b2a0de3ab8a.png"},25988:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/example3-52fa84bedc80477473ed09fb99f8816b.png"},7643:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/example4-c41752ec3f0212fb6caf85410f9d4df0.png"},45450:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/file-response1-704b5a983c9bc7b4cfeec52370469361.png"},37359:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/file_rules-8116962e123eca121af1bd1ff303db87.png"},69871:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/predefined-03d4bb0bb7ca99cadf197a306b791421.png"},37207:(e,i,s)=>{s.d(i,{A:()=>n});const n=s.p+"assets/images/securityevent-205a8be25138cc56ec707df24c24f54b.png"},28453:(e,i,s)=>{s.d(i,{R:()=>l,x:()=>r});var n=s(96540);const t={},o=n.createContext(t);function l(e){const i=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),n.createElement(o.Provider,{value:i},e.children)}}}]);